@page "/"
@inject IJSRuntime JS
@inject IndexRazor Http
@implements IAsyncDisposable

<PageTitle>Home</PageTitle>

<MudText Typo="Typo.h3" GutterBottom="true">Hello, world!</MudText>
<MudText Class="mb-8">Welcome to my new web site, powered by MudBlazor!</MudText>
<MudAlert Severity="Severity.Normal">You can find documentation and examples on our website here: <MudLink Href="https://mudblazor.com" Typo="Typo.body2" Color="Color.Inherit"><b>www.mudblazor.com</b></MudLink></MudAlert>
<MudTimeline Class="mt-8">
    @foreach (var item in itemSource)
    {
        <MudTimelineItem Color="Color.Info" Size="Size.Small">
            <ItemOpposite>
                <MudText Color="Color.Info" Typo="Typo.h5">@item.Year</MudText>
            </ItemOpposite>
            <ItemContent>
                <MudText Color="Color.Info" Typo="Typo.h6" GutterBottom="true">@item.Info</MudText>
                <MudText>@item.Desc</MudText>
            </ItemContent>
        </MudTimelineItem>
    }
</MudTimeline>


@code {
    private List<TimeLine> itemSource = new();
    private Lazy<IJSObjectReference> IndexModule = new();

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            var module = await JS.InvokeAsync<IJSObjectReference>("import", "./Pages/Index.razor.js");
            IndexModule = new Lazy<IJSObjectReference>(module);
            await IndexModule.Value.InvokeVoidAsync("SayHelloFromJs");
        }
    }

    protected override async Task OnInitializedAsync()
    {
        var items = await Http.FetchDataAsync();
        itemSource.AddRange(items);
    }

    public async ValueTask DisposeAsync()
    {
        if (IndexModule.IsValueCreated)
        {
            await IndexModule.Value.DisposeAsync();
        }
    }
}

